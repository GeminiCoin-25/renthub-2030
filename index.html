<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RentHub 2030 - La plataforma de alquiler m√°s confiable</title>
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' https://www.gstatic.com https://cdnjs.cloudflare.com 'unsafe-inline';
        style-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline';
        img-src 'self' https: data:;
        connect-src 'self' https://*.firebaseapp.com https://*.googleapis.com;
        font-src 'self' https://cdnjs.cloudflare.com;
    ">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ======================================================= */
        /* == ÿ™ÿµŸÖŸäŸÖ CSS ÿßŸÑŸÖÿ≠ÿØÿ´: ÿßŸÑÿ£ŸÑŸàÿßŸÜ ŸàÿßŸÑÿ¥ÿ®ŸÉÿßÿ™ ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© == */
        /* ======================================================= */
        :root {
            /* ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ¨ÿØŸäÿØÿ©: ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©ÿå ÿØÿßŸÅÿ¶ÿ©ÿå ŸàŸáÿßÿØÿ¶ÿ© */
            --primary: #5E35B1;
            --secondary: #6A5ACD;
            --success: #2ecc71;
            --light: #F5F5F5;
            --dark: #1A1A1A;
            --gray: #6C757D;
            --accent: #FF8A65;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            line-height: 1.6;
            color: var(--dark);
            background-color: white;
        }

        /* Header & Navbar */
        header {
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.08);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 5%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--dark);
            text-decoration: none;
        }

        .logo i {
            font-size: 1.8rem;
            color: var(--primary);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.6rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn-outline {
            border: 2px solid var(--primary);
            color: var(--primary);
            background: transparent;
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(94, 53, 177, 0.4);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, rgba(94, 53, 177, 0.9), rgba(106, 90, 205, 0.9)), 
                        url('https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 150px 5% 100px;
            text-align: center;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: fadeInDown 1s;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 2rem;
            opacity: 0.9;
        }

        .search-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 900px;
            margin: 2rem auto;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
            gap: 15px;
        }

        .search-input {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(94, 53, 177, 0.2);
        }

        /* Categories */
        .categories {
            padding: 5rem 5%;
            max-width: 1400px;
            margin: 0 auto;
            background-color: var(--light);
        }

        .section-title {
            text-align: center;
            margin-bottom: 3rem;
        }

        .section-title h2 {
            font-size: 2.5rem;
            color: var(--dark);
            margin-bottom: 1rem;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .category-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            text-decoration: none;
            color: inherit;
            cursor: pointer;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(94, 53, 177, 0.2);
        }

        .category-icon {
            font-size: 3rem;
            padding: 2rem;
            text-align: center;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .category-info {
            padding: 1.5rem;
        }

        .category-info h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
        }

        /* Featured Listings */
        .featured {
            padding: 5rem 5%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .listings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
        }

        .listing-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .listing-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(94, 53, 177, 0.2);
        }

        .listing-img {
            height: 200px;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .listing-price {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--accent);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            font-weight: bold;
        }

        .listing-info {
            padding: 1.5rem;
        }

        .listing-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .listing-location {
            color: var(--gray);
            margin-bottom: 1rem;
        }

        .listing-features {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }

        /* How It Works */
        .how-it-works {
            padding: 5rem 5%;
            background-color: var(--light);
        }

        .steps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .step {
            text-align: center;
        }

        .step-number {
            width: 60px;
            height: 60px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0 auto 1.5rem;
        }

        .step h3 {
            margin-bottom: 1rem;
            color: var(--dark);
        }

        /* Footer */
        footer {
            background: var(--dark);
            color: white;
            padding: 3rem 5% 1rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto 2rem;
        }

        .footer-links h4 {
            margin-bottom: 1rem;
            color: var(--accent);
        }

        .footer-links ul {
            list-style: none;
        }

        .footer-links ul li {
            margin-bottom: 0.5rem;
        }

        .footer-links a {
            color: #ccc;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Error/Success Messages */
        .alert {
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            display: none;
        }

        .alert-error {
            background: #fee;
            color: #c33;
            border-left: 4px solid #c33;
        }

        .alert-success {
            background: #efe;
            color: #3c3;
            border-left: 4px solid #3c3;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .search-box {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <nav class="navbar">
            <a href="index.html" class="logo">
                <i class="fas fa-cube"></i>
                <span>RentHub</span>
            </a>
            
            <div class="nav-links">
                <a href="#categories">Categor√≠as</a>
                <a href="#how-it-works">C√≥mo Funciona</a>
                <a href="#listings">Productos</a>
                <a href="dashboard.html">Mi Cuenta</a>
            </div>
            
            <div class="nav-buttons" id="authButtons">
                <!-- Botones din√°micos -->
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <h1>Alquila lo que necesitas, cuando lo necesitas</h1>
        <p>Desde herramientas profesionales hasta equipos deportivos. Miles de productos disponibles en tu ciudad.</p>
        
        <div class="search-box">
            <input type="text" id="searchInput" class="search-input" placeholder="¬øQu√© buscas?" maxlength="100">
            <input type="text" id="locationInput" class="search-input" placeholder="Ciudad" maxlength="50">
            <select id="categorySelect" class="search-input">
                <option value="">Todas las categor√≠as</option>
                <option value="herramientas">Herramientas</option>
                <option value="electronica">Electr√≥nica</option>
                <option value="deportes">Deportes</option>
                <option value="vehiculos">Veh√≠culos</option>
                <option value="eventos">Eventos</option>
            </select>
            <select id="durationSelect" class="search-input">
                <option value="">Duraci√≥n</option>
                <option value="hora">Por hora</option>
                <option value="dia">Por d√≠a</option>
                <option value="semana">Por semana</option>
                <option value="mes">Por mes</option>
            </select>
            <input type="number" id="maxPriceInput" class="search-input" placeholder="Precio m√°x (‚Ç¨)" min="0" max="10000">
            <button class="btn btn-primary" onclick="searchListings()">
                <i class="fas fa-search"></i> Buscar
            </button>
        </div>
    </section>

    <!-- Categories -->
    <section class="categories" id="categories">
        <div class="section-title">
            <h2>Explora por Categor√≠as</h2>
            <p>Encuentra exactamente lo que necesitas</p>
        </div>
        
        <div class="categories-grid">
            <a href="listings.html?category=herramientas" class="category-card">
                <div class="category-icon">
                    <i class="fas fa-tools"></i>
                </div>
                <div class="category-info">
                    <h3>Herramientas</h3>
                    <p>Equipos profesionales para bricolaje y construcci√≥n</p>
                </div>
            </a>
            
            <a href="listings.html?category=electronica" class="category-card">
                <div class="category-icon">
                    <i class="fas fa-camera"></i>
                </div>
                <div class="category-info">
                    <h3>Electr√≥nica</h3>
                    <p>C√°maras, drones, equipos de sonido y m√°s</p>
                </div>
            </a>
            
            <a href="listings.html?category=deportes" class="category-card">
                <div class="category-icon">
                    <i class="fas fa-bicycle"></i>
                </div>
                <div class="category-info">
                    <h3>Deportes</h3>
                    <p>Bicicletas, esqu√≠s, kayaks y equipamiento</p>
                </div>
            </a>
            
            <a href="listings.html?category=vehiculos" class="category-card">
                <div class="category-icon">
                    <i class="fas fa-car"></i>
                </div>
                <div class="category-info">
                    <h3>Veh√≠culos</h3>
                    <p>Coches, motos, furgonetas y m√°s</p>
                </div>
            </a>
            
            <a href="listings.html?category=eventos" class="category-card">
                <div class="category-icon">
                    <i class="fas fa-glass-cheers"></i>
                </div>
                <div class="category-info">
                    <h3>Eventos</h3>
                    <p>Equipos para bodas, fiestas y celebraciones</p>
                </div>
            </a>
            
            <a href="listings.html?category=jardin" class="category-card">
                <div class="category-icon">
                    <i class="fas fa-leaf"></i>
                </div>
                <div class="category-info">
                    <h3>Jard√≠n</h3>
                    <p>Cortac√©spedes, desbrozadoras y m√°s</p>
                </div>
            </a>
        </div>
    </section>

    <!-- Featured Listings -->
    <section class="featured" id="listings">
        <div class="section-title">
            <h2>Productos Destacados</h2>
            <p>Los m√°s populares de tu zona</p>
        </div>
        
        <div class="listings-grid" id="featuredListings">
            <!-- Productos din√°micos -->
        </div>
    </section>

    <!-- How It Works -->
    <section class="how-it-works" id="how-it-works">
        <div class="section-title">
            <h2>¬øC√≥mo Funciona?</h2>
            <p>Tan f√°cil como 1, 2, 3</p>
        </div>
        
        <div class="steps-grid">
            <div class="step">
                <div class="step-number">1</div>
                <h3>Busca</h3>
                <p>Encuentra el producto perfecto entre miles de opciones disponibles en tu ciudad</p>
            </div>
            
            <div class="step">
                <div class="step-number">2</div>
                <h3>Reserva</h3>
                <p>Reserva online de forma segura. Pago protegido y verificado</p>
            </div>
            
            <div class="step">
                <div class="step-number">3</div>
                <h3>Disfruta</h3>
                <p>Recoge el producto y √∫salo. Devu√©lvelo cuando termines</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-links">
                <h4>RentHub</h4>
                <p>La plataforma l√≠der de alquiler en Espa√±a. Conectando personas con lo que necesitan.</p>
            </div>
            
            <div class="footer-links">
                <h4>Enlaces</h4>
                <ul>
                    <li><a href="#categories">Categor√≠as</a></li>
                    <li><a href="#how-it-works">C√≥mo Funciona</a></li>
                    <li><a href="#listings">Productos</a></li>
                    <li><a href="dashboard.html">Mi Cuenta</a></li>
                </ul>
            </div>
            
            <div class="footer-links">
                <h4>Legal</h4>
                <ul>
                    <li><a href="#">T√©rminos y Condiciones</a></li>
                    <li><a href="#">Pol√≠tica de Privacidad</a></li>
                    <li><a href="#">Pol√≠tica de Cookies</a></li>
                    <li><a href="#">Aviso Legal</a></li>
                </ul>
            </div>
            
            <div class="footer-links">
                <h4>Contacto</h4>
                <ul>
                    <li><i class="fas fa-envelope"></i> info@renthub.es</li>
                    <li><i class="fas fa-phone"></i> +34 900 123 456</li>
                    <li><i class="fas fa-map-marker-alt"></i> Madrid, Espa√±a</li>
                </ul>
            </div>
        </div>
        
        <div class="copyright">
            <p>&copy; 2024 RentHub. Todos los derechos reservados.</p>
        </div>
    </footer>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // ========================================
        // üîí SECURITY UTILITIES
        // ========================================
        
        const SecurityUtils = {
            // XSS Protection: ÿ™ÿπŸÇŸäŸÖ ÿßŸÑŸÜÿµŸàÿµ
            sanitizeText(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = String(text);
                return div.innerHTML;
            },
            
            // ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑŸÄ URL
            isValidURL(url) {
                try {
                    const urlObj = new URL(url);
                    return urlObj.protocol === 'https:' && 
                           (urlObj.hostname.includes('unsplash.com') || 
                            urlObj.hostname.includes('cloudinary.com') ||
                            urlObj.hostname.includes('firebasestorage.googleapis.com'));
                } catch {
                    return false;
                }
            },
            
            // ÿ™ÿπŸÇŸäŸÖ ÿßŸÑŸÄ URL
            sanitizeURL(url) {
                return this.isValidURL(url) ? url : 'https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80';
            },
            
            // Input Validation
            validateSearchInput(input, maxLength = 100) {
                if (!input) return '';
                return String(input).trim().slice(0, maxLength);
            },
            
            // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ
            validateNumber(num, min = 0, max = 10000) {
                const parsed = parseFloat(num);
                if (isNaN(parsed)) return null;
                return Math.max(min, Math.min(max, parsed));
            },
            
            // Rate Limiting (ÿ®ÿ≥Ÿäÿ∑)
            rateLimiter: {
                requests: {},
                isAllowed(key, maxRequests = 10, timeWindow = 60000) {
                    const now = Date.now();
                    if (!this.requests[key]) {
                        this.requests[key] = [];
                    }
                    
                    // ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÇÿØŸäŸÖÿ©
                    this.requests[key] = this.requests[key].filter(
                        time => now - time < timeWindow
                    );
                    
                    if (this.requests[key].length >= maxRequests) {
                        return false;
                    }
                    
                    this.requests[key].push(now);
                    return true;
                }
            }
        };

        // ========================================
        // üî• FIREBASE CONFIGURATION
        // ========================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyDA223bKA90MX_QpWuF1ARgWKldjXuiNo4",
            authDomain: "renthub-2030.firebaseapp.com",
            projectId: "renthub-2030",
            storageBucket: "renthub-2030.firebasestorage.app",
            messagingSenderId: "23301901800",
            appId: "1:23301901800:web:2679c834aac406c72d685d"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ========================================
        // üîê AUTHENTICATION
        // ========================================
        
        auth.onAuthStateChanged((user) => {
            updateAuthButtons(user);
            if (user) {
                loadFeaturedListings();
            } else {
                loadFeaturedListings();
            }
        });

        function updateAuthButtons(user) {
            const authButtons = document.getElementById('authButtons');
            
            if (user) {
                const dashboardBtn = document.createElement('a');
                dashboardBtn.href = 'dashboard.html';
                dashboardBtn.className = 'btn btn-outline';
                dashboardBtn.innerHTML = '<i class="fas fa-user-circle"></i> Mi Panel';
                
                const logoutBtn = document.createElement('button');
                logoutBtn.className = 'btn btn-primary';
                logoutBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n';
                logoutBtn.onclick = logout;
                
                authButtons.innerHTML = '';
                authButtons.appendChild(dashboardBtn);
                authButtons.appendChild(logoutBtn);
            } else {
                const loginBtn = document.createElement('a');
                loginBtn.href = 'auth.html';
                loginBtn.className = 'btn btn-outline';
                loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Iniciar Sesi√≥n';
                
                const registerBtn = document.createElement('a');
                registerBtn.href = 'auth.html';
                registerBtn.className = 'btn btn-primary';
                registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> Registrarse';
                registerBtn.onclick = switchToRegister;
                
                authButtons.innerHTML = '';
                authButtons.appendChild(loginBtn);
                authButtons.appendChild(registerBtn);
            }
        }

        function logout() {
            auth.signOut()
                .then(() => {
                    window.location.reload();
                })
                .catch((error) => {
                    console.error('Logout error');
                    showAlert('Error al cerrar sesi√≥n', 'error');
                });
        }

        function switchToRegister() {
            try {
                sessionStorage.setItem('authTab', 'register');
            } catch (e) {
                console.error('Storage error');
            }
        }

        // ========================================
        // üì¶ LOAD LISTINGS (SECURE)
        // ========================================
        
        async function loadFeaturedListings() {
            if (!SecurityUtils.rateLimiter.isAllowed('loadListings', 5, 10000)) {
                console.warn('Too many requests');
                return;
            }
            
            try {
                const listingsRef = db.collection('listings');
                const snapshot = await listingsRef
                    .where('featured', '==', true)
                    .limit(6)
                    .get();
                
                const listingsGrid = document.getElementById('featuredListings');
                listingsGrid.innerHTML = '';
                
                if (snapshot.empty) {
                    displaySampleListings();
                } else {
                    snapshot.forEach(doc => {
                        const listing = doc.data();
                        const card = createSecureListingCard(doc.id, listing);
                        listingsGrid.appendChild(card);
                    });
                }
            } catch (error) {
                console.error('Load error');
                displaySampleListings();
            }
        }

        // ========================================
        // üõ°Ô∏è SECURE CARD CREATION (NO XSS)
        // ========================================
        
        function createSecureListingCard(id, listing) {
            const card = document.createElement('div');
            card.className = 'listing-card';
            
            const imgDiv = document.createElement('div');
            imgDiv.className = 'listing-img';
            const imageUrl = SecurityUtils.sanitizeURL(listing.images?.[0] || '');
            imgDiv.style.backgroundImage = `url('${imageUrl}')`;
            
            const priceSpan = document.createElement('span');
            priceSpan.className = 'listing-price';
            const price = SecurityUtils.validateNumber(listing.price, 0, 100000);
            priceSpan.textContent = `${price || '0'}‚Ç¨/${SecurityUtils.sanitizeText(listing.priceType || 'd√≠a')}`;
            imgDiv.appendChild(priceSpan);
            
            const infoDiv = document.createElement('div');
            infoDiv.className = 'listing-info';
            
            const title = document.createElement('h3');
            title.className = 'listing-title';
            title.textContent = SecurityUtils.sanitizeText(listing.title || 'Sin t√≠tulo');
            
            const location = document.createElement('div');
            location.className = 'listing-location';
            const locationIcon = document.createElement('i');
            locationIcon.className = 'fas fa-map-marker-alt';
            location.appendChild(locationIcon);
            location.appendChild(document.createTextNode(' ' + SecurityUtils.sanitizeText(listing.location || 'Espa√±a')));
            
            const features = document.createElement('div');
            features.className = 'listing-features';
            
            const categorySpan = document.createElement('span');
            categorySpan.textContent = SecurityUtils.sanitizeText(listing.category || 'General');
            
            const viewBtn = document.createElement('button');
            viewBtn.className = 'btn btn-primary';
            viewBtn.textContent = 'Ver Detalles';
            viewBtn.onclick = () => viewListing(SecurityUtils.sanitizeText(id));
            
            features.appendChild(categorySpan);
            features.appendChild(viewBtn);
            
            infoDiv.appendChild(title);
            infoDiv.appendChild(location);
            infoDiv.appendChild(features);
            
            card.appendChild(imgDiv);
            card.appendChild(infoDiv);
            
            return card;
        }

        // ========================================
        // üéØ SAMPLE LISTINGS (FALLBACK)
        // ========================================
        
        function displaySampleListings() {
            const sampleListings = [
                {
                    id: '1',
                    title: 'Taladro Percutor Profesional',
                    location: 'Madrid',
                    price: 15,
                    priceType: 'd√≠a',
                    images: ['https://images.unsplash.com/photo-1581094794329-c8112a89af12?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'],
                    category: 'Herramientas'
                },
                {
                    id: '2',
                    title: 'C√°mara DSLR Canon EOS',
                    location: 'Barcelona',
                    price: 40,
                    priceType: 'd√≠a',
                    images: ['https://images.unsplash.com/photo-1516035069371-29a1b244cc32?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'],
                    category: 'Electr√≥nica'
                },
                {
                    id: '3',
                    title: 'Bicicleta de Monta√±a',
                    location: 'Valencia',
                    price: 12,
                    priceType: 'd√≠a',
                    images: ['https://images.unsplash.com/photo-1532298229144-0ec0c57515c7?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'],
                    category: 'Deportes'
                }
            ];
            
            const listingsGrid = document.getElementById('featuredListings');
            listingsGrid.innerHTML = '';
            
            sampleListings.forEach(listing => {
                const card = createSecureListingCard(listing.id, listing);
                listingsGrid.appendChild(card);
            });
        }

        // ========================================
        // üîç SECURE SEARCH
        // ========================================
        
        function searchListings() {
            const query = SecurityUtils.validateSearchInput(
                document.getElementById('searchInput').value, 100
            );
            const location = SecurityUtils.validateSearchInput(
                document.getElementById('locationInput').value, 50
            );
            const category = document.getElementById('categorySelect').value;
            const duration = document.getElementById('durationSelect').value;
            const maxPriceInput = document.getElementById('maxPriceInput').value;
            const maxPrice = SecurityUtils.validateNumber(maxPriceInput, 0, 10000);
            
            const params = [];
            if (query) params.push(`q=${encodeURIComponent(query)}`);
            if (location) params.push(`location=${encodeURIComponent(location)}`);
            if (category) params.push(`category=${encodeURIComponent(category)}`);
            if (duration) params.push(`duration=${encodeURIComponent(duration)}`);
            if (maxPrice !== null) params.push(`maxPrice=${maxPrice}`);
            
            window.location.href = 'listings.html?' + params.join('&');
        }

        function viewListing(id) {
            if (!id) return;
            window.location.href = `listing-detail.html?id=${encodeURIComponent(id)}`;
        }

        // ========================================
        // üé® UI HELPERS
        // ========================================
        
        function showAlert(message, type = 'error') {
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // ========================================
        // üöÄ INITIALIZATION
        // ========================================
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('‚úÖ RentHub Secure - Ready');
            
            loadFeaturedListings();
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        searchListings();
                    }
                });
            }
        });
    </script>
</body>
</html>
üî• 2. Firebase Security Rules (firestore.rules)
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ========================================
    // üîí SECURITY RULES FOR RENTHUB
    // ========================================
    
    // Helper Functions
    function isSignedIn() {
      return request.auth != null;
    }
    
    function isOwner(userId) {
      return isSignedIn() && request.auth.uid == userId;
    }
    
    function isValidString(text, minLen, maxLen) {
      return text is string && 
             text.size() >= minLen && 
             text.size() <= maxLen;
    }
    
    function isValidPrice(price) {
      return price is number && 
             price >= 0 && 
             price <= 100000;
    }
    
    function isValidEmail(email) {
      return email is string && 
             email.matches('.*@.*\\..*');
    }
    
    // ========================================
    // LISTINGS COLLECTION
    // ========================================
    match /listings/{listingId} {
      
      // ÿßŸÑŸÇÿ±ÿßÿ°ÿ©: ŸÖÿ™ÿßÿ≠ÿ© ŸÑŸÑÿ¨ŸÖŸäÿπ
      allow read: if true;
      
      // ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°: ŸÅŸÇÿ∑ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ÿßŸÑŸÖÿ≥ÿ¨ŸÑŸäŸÜ
      allow create: if isSignedIn() &&
        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        isValidString(request.resource.data.title, 5, 100) &&
        isValidString(request.resource.data.description, 10, 2000) &&
        isValidString(request.resource.data.location, 2, 50) &&
        isValidString(request.resource.data.category, 2, 50) &&
        isValidPrice(request.resource.data.price) &&
        request.resource.data.userId == request.auth.uid &&
        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿµŸàÿ±
        request.resource.data.images is list &&
        request.resource.data.images.size() >= 1 &&
        request.resource.data.images.size() <= 10 &&
        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÇŸäŸÖ ÿßŸÑŸÖŸÜÿ∑ŸÇŸäÿ©
        request.resource.data.available is bool &&
        request.resource.data.featured is bool &&
        // ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°
        request.resource.data.createdAt == request.time &&
        request.resource.data.updatedAt == request.time;
      
      // ÿßŸÑÿ™ÿ≠ÿØŸäÿ´: ŸÅŸÇÿ∑ ÿßŸÑŸÖÿßŸÑŸÉ
      allow update: if isSignedIn() &&
        resource.data.userId == request.auth.uid &&
        // ŸÑÿß ŸäŸÖŸÉŸÜ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÖÿßŸÑŸÉ ÿ£Ÿà ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°
        request.resource.data.userId == resource.data.userId &&
        request.resource.data.createdAt == resource.data.createdAt &&
        // ÿ™ÿ≠ÿØŸäÿ´ ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ™ÿπÿØŸäŸÑ
        request.resource.data.updatedAt == request.time &&
        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ÿØÿ´ÿ©
        isValidString(request.resource.data.title, 5, 100) &&
        isValidString(request.resource.data.description, 10, 2000) &&
        isValidPrice(request.resource.data.price);
      
      // ÿßŸÑÿ≠ÿ∞ŸÅ: ŸÅŸÇÿ∑ ÿßŸÑŸÖÿßŸÑŸÉ
      allow delete: if isSignedIn() &&
        resource.data.userId == request.auth.uid;
    }
    
    // ========================================
    // BOOKINGS COLLECTION
    // ========================================
    match /bookings/{bookingId} {
      
      // ÿßŸÑŸÇÿ±ÿßÿ°ÿ©: ÿßŸÑŸÖÿßŸÑŸÉ ÿ£Ÿà ÿßŸÑŸÖÿ≥ÿ™ÿ£ÿ¨ÿ± ŸÅŸÇÿ∑
      allow read: if isSignedIn() && (
        resource.data.renterId == request.auth.uid ||
        resource.data.ownerId == request.auth.uid
      );
      
      // ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°: ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÖÿ≥ÿ¨ŸÑ ŸÅŸÇÿ∑
      allow create: if isSignedIn() &&
        request.resource.data.renterId == request.auth.uid &&
        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿ™Ÿàÿßÿ±ŸäÿÆ
        request.resource.data.startDate is timestamp &&
        request.resource.data.endDate is timestamp &&
        request.resource.data.endDate > request.resource.data.startDate &&
        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ≥ÿπÿ±
        isValidPrice(request.resource.data.totalPrice) &&
        // ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ®ÿ™ÿØÿßÿ¶Ÿäÿ©
        request.resource.data.status == 'pending' &&
        request.resource.data.createdAt == request.time;
      
      // ÿßŸÑÿ™ÿ≠ÿØŸäÿ´: ÿßŸÑŸÖÿßŸÑŸÉ ŸÅŸÇÿ∑ (ŸÑÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿßŸÑÿ©)
      allow update: if isSignedIn() &&
        resource.data.ownerId == request.auth.uid &&
        // ŸäŸÖŸÉŸÜ ŸÅŸÇÿ∑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ÿßŸÑÿ©
        request.resource.data.status in ['approved', 'rejected', 'cancelled'] &&
        request.resource.data.updatedAt == request.time;
      
      // ÿßŸÑÿ≠ÿ∞ŸÅ: ÿ∫Ÿäÿ± ŸÖÿ≥ŸÖŸàÿ≠
      allow delete: if false;
    }
    
    // ========================================
    // USERS COLLECTION
    // ========================================
    match /users/{userId} {
      
      // ÿßŸÑŸÇÿ±ÿßÿ°ÿ©: ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÜŸÅÿ≥Ÿá ŸÅŸÇÿ∑
      allow read: if isSignedIn() && 
        request.auth.uid == userId;
      
      // ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°: ÿπŸÜÿØ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ŸÅŸÇÿ∑
      allow create: if isSignedIn() &&
        request.auth.uid == userId &&
        isValidString(request.resource.data.displayName, 2, 50) &&
        isValidEmail(request.resource.data.email) &&
        request.resource.data.createdAt == request.time;
      
      // ÿßŸÑÿ™ÿ≠ÿØŸäÿ´: ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÜŸÅÿ≥Ÿá ŸÅŸÇÿ∑
      allow update: if isSignedIn() &&
        request.auth.uid == userId &&
        // ŸÑÿß ŸäŸÖŸÉŸÜ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ®ÿ±ŸäÿØ ÿ£Ÿà ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°
        request.resource.data.email == resource.data.email &&
        request.resource.data.createdAt == resource.data.createdAt &&
        request.resource.data.updatedAt == request.time;
      
      // ÿßŸÑÿ≠ÿ∞ŸÅ: ÿ∫Ÿäÿ± ŸÖÿ≥ŸÖŸàÿ≠ (ÿßÿ≥ÿ™ÿÆÿØŸÖ Firebase Auth)
      allow delete: if false;
    }
    
    // ========================================
    // REVIEWS COLLECTION
    // ========================================
    match /reviews/{reviewId} {
      
      // ÿßŸÑŸÇÿ±ÿßÿ°ÿ©: ŸÖÿ™ÿßÿ≠ÿ© ŸÑŸÑÿ¨ŸÖŸäÿπ
      allow read: if true;
      
      // ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°: ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÖÿ≥ÿ¨ŸÑ ŸÅŸÇÿ∑
      allow create: if isSignedIn() &&
        request.resource.data.userId == request.auth.uid &&
        isValidString(request.resource.data.comment, 10, 500) &&
        request.resource.data.rating is number &&
        request.resource.data.rating >= 1 &&
        request.resource.data.rating <= 5 &&
        request.resource.data.createdAt == request.time;
      
      // ÿßŸÑÿ™ÿ≠ÿØŸäÿ´: ÿßŸÑŸÖÿßŸÑŸÉ ŸÅŸÇÿ∑
      allow update: if isSignedIn() &&
        resource.data.userId == request.auth.uid &&
        request.resource.data.updatedAt == request.time;
      
      // ÿßŸÑÿ≠ÿ∞ŸÅ: ÿßŸÑŸÖÿßŸÑŸÉ ŸÅŸÇÿ∑
      allow delete: if isSignedIn() &&
        resource.data.userId == request.auth.uid;
    }
    
    // ========================================
    // MESSAGES COLLECTION
    // ========================================
    match /messages/{messageId} {
      
      // ÿßŸÑŸÇÿ±ÿßÿ°ÿ©: ÿßŸÑŸÖÿ±ÿ≥ŸÑ ÿ£Ÿà ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ ŸÅŸÇÿ∑
      allow read: if isSignedIn() && (
        resource.data.senderId == request.auth.uid ||
        resource.data.receiverId == request.auth.uid
      );
      
      // ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°: ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÖÿ≥ÿ¨ŸÑ ŸÅŸÇÿ∑
      allow create: if isSignedIn() &&
        request.resource.data.senderId == request.auth.uid &&
        isValidString(request.resource.data.content, 1, 1000) &&
        request.resource.data.createdAt == request.time;
      
      // ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ŸàÿßŸÑÿ≠ÿ∞ŸÅ: ÿ∫Ÿäÿ± ŸÖÿ≥ŸÖŸàÿ≠
      allow update: if false;
      allow delete: if false;
    }
    
    // ========================================
    // ADMIN COLLECTION (ŸÑŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÅŸÇÿ∑)
    // ========================================
    match /admin/{document=**} {
      allow read, write: if false; // Admin SDK only
    }
    
    // ========================================
    // DEFAULT: ÿ±ŸÅÿ∂ ŸÉŸÑ ÿ¥Ÿäÿ° ÿ¢ÿÆÿ±
    // ========================================
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

// ========================================
// üî• FIREBASE STORAGE RULES
// ========================================

service firebase.storage {
  match /b/{bucket}/o {
    
    // Helper Functions
    function isSignedIn() {
      return request.auth != null;
    }
    
    function isImage() {
      return request.resource.contentType.matches('image/.*');
    }
    
    function isValidSize() {
      return request.resource.size < 5 * 1024 * 1024; // 5MB max
    }
    
    // ========================================
    // USER AVATARS
    // ========================================
    match /avatars/{userId}/{fileName} {
      allow read: if true;
      
      allow write: if isSignedIn() &&
        request.auth.uid == userId &&
        isImage() &&
        isValidSize();
    }
    
    // ========================================
    // LISTING IMAGES
    // ========================================
    match /listings/{userId}/{listingId}/{fileName} {
      allow read: if true;
      
      allow write: if isSignedIn() &&
        request.auth.uid == userId &&
        isImage() &&
        isValidSize();
      
      allow delete: if isSignedIn() &&
        request.auth.uid == userId;
    }
    
    // ========================================
    // DEFAULT: ÿ±ŸÅÿ∂ ŸÉŸÑ ÿ¥Ÿäÿ° ÿ¢ÿÆÿ±
    // ========================================
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}

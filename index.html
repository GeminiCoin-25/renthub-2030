<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RentHub 2030 - Plataforma líder de alquiler de productos en España</title>
    
    <!-- Meta Tags for SEO -->
    <meta name="description" content="Alquila herramientas, equipos deportivos, electrónica y más en RentHub. Miles de productos disponibles en tu ciudad con total seguridad y garantía.">
    <meta name="keywords" content="alquiler, herramientas, equipos, España, renta, productos, herramientas profesionales, equipo deportivo, electrónica">
    <meta name="author" content="RentHub">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="RentHub - Alquila lo que necesites">
    <meta property="og:description" content="La plataforma de alquiler más confiable de España">
    <meta property="og:image" content="https://renthub.es/images/og-image.jpg">
    <meta property="og:url" content="https://renthub.es">
    <meta property="og:site_name" content="RentHub">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="RentHub - Alquila lo que necesites">
    <meta name="twitter:description" content="La plataforma de alquiler más confiable de España">
    <meta name="twitter:image" content="https://renthub.es/images/twitter-image.jpg">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' https://www.gstatic.com https://cdnjs.cloudflare.com 'sha256-9VvHhZJpK6FjJLjw9F7wB9XfZ3zJpL9D3F5JqL9Zv5=';
        style-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline';
        img-src 'self' https: data: blob:;
        font-src 'self' https://cdnjs.cloudflare.com;
        connect-src 'self' https://*.firebaseapp.com https://*.googleapis.com https://*.firebaseio.com;
        frame-src 'none';
        object-src 'none';
        base-uri 'self';
        form-action 'self';
        frame-ancestors 'none';
        block-all-mixed-content;
        upgrade-insecure-requests;
    ">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" crossorigin="anonymous">
    <link rel="preload" href="https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80" as="image">
    
    <!-- Styles -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- Inline Critical CSS -->
    <style>
        /* Critical CSS for Above-the-fold content */
        :root {
            --primary-50: #f3e5f5;
            --primary-100: #e1bee7;
            --primary-200: #ce93d8;
            --primary-300: #ba68c8;
            --primary-400: #ab47bc;
            --primary-500: #9c27b0;
            --primary-600: #8e24aa;
            --primary-700: #7b1fa2;
            --primary-800: #6a1b9a;
            --primary-900: #4a148c;
            
            --secondary-50: #f3e5f5;
            --secondary-100: #e1bee7;
            --secondary-500: #9c27b0;
            --secondary-900: #4a148c;
            
            --accent-50: #fff3e0;
            --accent-100: #ffe0b2;
            --accent-500: #ff9800;
            --accent-700: #f57c00;
            
            --success-500: #4caf50;
            --warning-500: #ff9800;
            --error-500: #f44336;
            --info-500: #2196f3;
            
            --gray-50: #fafafa;
            --gray-100: #f5f5f5;
            --gray-200: #eeeeee;
            --gray-300: #e0e0e0;
            --gray-400: #bdbdbd;
            --gray-500: #9e9e9e;
            --gray-600: #757575;
            --gray-700: #616161;
            --gray-800: #424242;
            --gray-900: #212121;
            
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.15);
            
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            
            --transition-fast: 150ms ease;
            --transition-base: 250ms ease;
            --transition-slow: 350ms ease;
        }
        
        /* Reset and Base Styles */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--gray-900);
            background-color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        .focus-visible:focus {
            outline: 3px solid var(--primary-500);
            outline-offset: 2px;
        }
        
        /* Header and Navigation */
        .main-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-base);
        }
        
        .main-header.scrolled {
            box-shadow: var(--shadow-md);
        }
        
        /* Loading States */
        .skeleton {
            background: linear-gradient(90deg, var(--gray-100) 25%, var(--gray-200) 50%, var(--gray-100) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
    </style>
    
    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "RentHub",
        "alternateName": "RentHub España",
        "url": "https://renthub.es",
        "description": "Plataforma de alquiler de productos en España",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://renthub.es/listings.html?q={search_term_string}",
            "query-input": "required name=search_term_string"
        },
        "publisher": {
            "@type": "Organization",
            "name": "RentHub",
            "logo": {
                "@type": "ImageObject",
                "url": "https://renthub.es/logo.png",
                "width": 200,
                "height": 60
            }
        },
        "sameAs": [
            "https://facebook.com/renthubes",
            "https://twitter.com/renthubes",
            "https://instagram.com/renthubes"
        ]
    }
    </script>
</head>
<body>
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="sr-only focus-visible" aria-label="Saltar al contenido principal">
        Saltar al contenido principal
    </a>
    
    <!-- Header -->
    <header class="main-header" role="banner" aria-label="Cabecera principal">
        <nav class="navbar" aria-label="Navegación principal">
            <div class="container">
                <div class="nav-content">
                    <!-- Logo -->
                    <a href="index.html" class="logo" aria-label="RentHub - Inicio">
                        <i class="fas fa-cube" aria-hidden="true"></i>
                        <span>RentHub</span>
                    </a>
                    
                    <!-- Mobile Menu Toggle -->
                    <button class="mobile-menu-toggle" aria-label="Abrir menú" aria-expanded="false" aria-controls="main-menu">
                        <i class="fas fa-bars" aria-hidden="true"></i>
                    </button>
                    
                    <!-- Navigation Links -->
                    <div class="nav-menu" id="main-menu" role="navigation">
                        <ul class="nav-links">
                            <li><a href="#categories" class="nav-link">Categorías</a></li>
                            <li><a href="#how-it-works" class="nav-link">Cómo Funciona</a></li>
                            <li><a href="#featured-listings" class="nav-link">Productos</a></li>
                            <li><a href="dashboard.html" class="nav-link">Mi Cuenta</a></li>
                        </ul>
                        
                        <!-- Auth Buttons -->
                        <div class="nav-buttons" id="authButtons" role="region" aria-label="Controles de autenticación">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main id="main-content" role="main" tabindex="-1">
        <!-- Hero Section -->
        <section class="hero" aria-labelledby="hero-title">
            <div class="container">
                <div class="hero-content">
                    <h1 id="hero-title" class="hero-title">
                        Alquila lo que necesitas, cuando lo necesitas
                    </h1>
                    <p class="hero-description">
                        Desde herramientas profesionales hasta equipos deportivos. Miles de productos disponibles en tu ciudad.
                    </p>
                    
                    <!-- Search Form -->
                    <form class="search-form" role="search" aria-label="Buscar productos">
                        <div class="search-grid">
                            <div class="search-field">
                                <label for="search-input" class="sr-only">¿Qué buscas?</label>
                                <input 
                                    type="search" 
                                    id="search-input"
                                    class="search-input"
                                    placeholder="¿Qué buscas?"
                                    maxlength="100"
                                    aria-describedby="search-help"
                                >
                                <div id="search-help" class="sr-only">
                                    Introduce el nombre del producto que buscas
                                </div>
                            </div>
                            
                            <div class="search-field">
                                <label for="location-input" class="sr-only">Ciudad</label>
                                <input 
                                    type="text" 
                                    id="location-input"
                                    class="search-input"
                                    placeholder="Ciudad"
                                    maxlength="50"
                                    list="locations"
                                >
                                <datalist id="locations">
                                    <option value="Madrid">
                                    <option value="Barcelona">
                                    <option value="Valencia">
                                    <option value="Sevilla">
                                    <option value="Zaragoza">
                                    <option value="Málaga">
                                    <option value="Murcia">
                                    <option value="Palma de Mallorca">
                                    <option value="Las Palmas">
                                    <option value="Bilbao">
                                </datalist>
                            </div>
                            
                            <div class="search-field">
                                <label for="category-select" class="sr-only">Categoría</label>
                                <select id="category-select" class="search-select" aria-label="Seleccionar categoría">
                                    <option value="">Todas las categorías</option>
                                    <option value="herramientas">Herramientas</option>
                                    <option value="electronica">Electrónica</option>
                                    <option value="deportes">Deportes</option>
                                    <option value="vehiculos">Vehículos</option>
                                    <option value="eventos">Eventos</option>
                                </select>
                            </div>
                            
                            <div class="search-field">
                                <label for="duration-select" class="sr-only">Duración</label>
                                <select id="duration-select" class="search-select" aria-label="Seleccionar duración">
                                    <option value="">Duración</option>
                                    <option value="hora">Por hora</option>
                                    <option value="dia">Por día</option>
                                    <option value="semana">Por semana</option>
                                    <option value="mes">Por mes</option>
                                </select>
                            </div>
                            
                            <div class="search-field">
                                <label for="max-price-input" class="sr-only">Precio máximo (€)</label>
                                <input 
                                    type="number" 
                                    id="max-price-input"
                                    class="search-input"
                                    placeholder="Precio máx (€)"
                                    min="0"
                                    max="10000"
                                    step="0.01"
                                >
                            </div>
                            
                            <button 
                                type="submit" 
                                class="search-button"
                                aria-label="Buscar productos"
                                onclick="searchListings(); return false;"
                            >
                                <i class="fas fa-search" aria-hidden="true"></i>
                                <span>Buscar</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Categories Section -->
        <section id="categories" class="categories" aria-labelledby="categories-title">
            <div class="container">
                <header class="section-header">
                    <h2 id="categories-title" class="section-title">Explora por Categorías</h2>
                    <p class="section-subtitle">Encuentra exactamente lo que necesitas</p>
                </header>
                
                <div class="categories-grid">
                    <!-- Category Cards -->
                    <a href="listings.html?category=herramientas" class="category-card" aria-label="Ver herramientas">
                        <div class="category-icon" aria-hidden="true">
                            <i class="fas fa-tools"></i>
                        </div>
                        <div class="category-content">
                            <h3 class="category-title">Herramientas</h3>
                            <p class="category-description">Equipos profesionales para bricolaje y construcción</p>
                        </div>
                    </a>
                    
                    <a href="listings.html?category=electronica" class="category-card" aria-label="Ver electrónica">
                        <div class="category-icon" aria-hidden="true">
                            <i class="fas fa-camera"></i>
                        </div>
                        <div class="category-content">
                            <h3 class="category-title">Electrónica</h3>
                            <p class="category-description">Cámaras, drones, equipos de sonido y más</p>
                        </div>
                    </a>
                    
                    <a href="listings.html?category=deportes" class="category-card" aria-label="Ver deportes">
                        <div class="category-icon" aria-hidden="true">
                            <i class="fas fa-bicycle"></i>
                        </div>
                        <div class="category-content">
                            <h3 class="category-title">Deportes</h3>
                            <p class="category-description">Bicicletas, esquís, kayaks y equipamiento</p>
                        </div>
                    </a>
                    
                    <a href="listings.html?category=vehiculos" class="category-card" aria-label="Ver vehículos">
                        <div class="category-icon" aria-hidden="true">
                            <i class="fas fa-car"></i>
                        </div>
                        <div class="category-content">
                            <h3 class="category-title">Vehículos</h3>
                            <p class="category-description">Coches, motos, furgonetas y más</p>
                        </div>
                    </a>
                    
                    <a href="listings.html?category=eventos" class="category-card" aria-label="Ver eventos">
                        <div class="category-icon" aria-hidden="true">
                            <i class="fas fa-glass-cheers"></i>
                        </div>
                        <div class="category-content">
                            <h3 class="category-title">Eventos</h3>
                            <p class="category-description">Equipos para bodas, fiestas y celebraciones</p>
                        </div>
                    </a>
                    
                    <a href="listings.html?category=jardin" class="category-card" aria-label="Ver jardín">
                        <div class="category-icon" aria-hidden="true">
                            <i class="fas fa-leaf"></i>
                        </div>
                        <div class="category-content">
                            <h3 class="category-title">Jardín</h3>
                            <p class="category-description">Cortacéspedes, desbrozadoras y más</p>
                        </div>
                    </a>
                </div>
            </div>
        </section>

        <!-- Featured Listings Section -->
        <section id="featured-listings" class="featured-listings" aria-labelledby="featured-title">
            <div class="container">
                <header class="section-header">
                    <h2 id="featured-title" class="section-title">Productos Destacados</h2>
                    <p class="section-subtitle">Los más populares de tu zona</p>
                </header>
                
                <div class="listings-grid" id="featuredListings" role="list" aria-label="Lista de productos destacados">
                    <!-- Dynamic content will be inserted here -->
                    <div class="skeleton-listing" role="listitem">
                        <div class="skeleton-image"></div>
                        <div class="skeleton-content">
                            <div class="skeleton-title"></div>
                            <div class="skeleton-text"></div>
                        </div>
                    </div>
                    <!-- Repeat skeleton for loading state -->
                </div>
            </div>
        </section>

        <!-- How It Works Section -->
        <section id="how-it-works" class="how-it-works" aria-labelledby="how-it-works-title">
            <div class="container">
                <header class="section-header">
                    <h2 id="how-it-works-title" class="section-title">¿Cómo Funciona?</h2>
                    <p class="section-subtitle">Tan fácil como 1, 2, 3</p>
                </header>
                
                <div class="steps-grid">
                    <article class="step" aria-label="Paso 1: Busca">
                        <div class="step-number" aria-hidden="true">1</div>
                        <h3 class="step-title">Busca</h3>
                        <p class="step-description">
                            Encuentra el producto perfecto entre miles de opciones disponibles en tu ciudad
                        </p>
                    </article>
                    
                    <article class="step" aria-label="Paso 2: Reserva">
                        <div class="step-number" aria-hidden="true">2</div>
                        <h3 class="step-title">Reserva</h3>
                        <p class="step-description">
                            Reserva online de forma segura. Pago protegido y verificado
                        </p>
                    </article>
                    
                    <article class="step" aria-label="Paso 3: Disfruta">
                        <div class="step-number" aria-hidden="true">3</div>
                        <h3 class="step-title">Disfruta</h3>
                        <p class="step-description">
                            Recoge el producto y úsalo. Devuélvelo cuando termines
                        </p>
                    </article>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="main-footer" role="contentinfo">
        <div class="container">
            <div class="footer-grid">
                <!-- Company Info -->
                <div class="footer-section">
                    <h3 class="footer-title">RentHub</h3>
                    <p class="footer-description">
                        La plataforma líder de alquiler en España. Conectando personas con lo que necesitan.
                    </p>
                </div>
                
                <!-- Quick Links -->
                <div class="footer-section">
                    <h3 class="footer-title">Enlaces</h3>
                    <ul class="footer-links">
                        <li><a href="#categories" class="footer-link">Categorías</a></li>
                        <li><a href="#how-it-works" class="footer-link">Cómo Funciona</a></li>
                        <li><a href="#featured-listings" class="footer-link">Productos</a></li>
                        <li><a href="dashboard.html" class="footer-link">Mi Cuenta</a></li>
                    </ul>
                </div>
                
                <!-- Legal Links -->
                <div class="footer-section">
                    <h3 class="footer-title">Legal</h3>
                    <ul class="footer-links">
                        <li><a href="terms.html" class="footer-link">Términos y Condiciones</a></li>
                        <li><a href="privacy.html" class="footer-link">Política de Privacidad</a></li>
                        <li><a href="cookies.html" class="footer-link">Política de Cookies</a></li>
                        <li><a href="legal.html" class="footer-link">Aviso Legal</a></li>
                    </ul>
                </div>
                
                <!-- Contact Info -->
                <div class="footer-section">
                    <h3 class="footer-title">Contacto</h3>
                    <address class="footer-address">
                        <ul class="footer-links">
                            <li>
                                <i class="fas fa-envelope" aria-hidden="true"></i>
                                <a href="mailto:info@renthub.es" class="footer-link">info@renthub.es</a>
                            </li>
                            <li>
                                <i class="fas fa-phone" aria-hidden="true"></i>
                                <a href="tel:+34900123456" class="footer-link">+34 900 123 456</a>
                            </li>
                            <li>
                                <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
                                <span>Madrid, España</span>
                            </li>
                        </ul>
                    </address>
                </div>
            </div>
            
            <!-- Copyright -->
            <div class="footer-bottom">
                <p class="copyright">
                    &copy; <span id="current-year"></span> RentHub. Todos los derechos reservados.
                </p>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <!-- Main JavaScript -->
    <script>
        // Strict mode for better error handling
        'use strict';
        
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registrado:', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registro fallido:', error);
                    });
            });
        }

        // App Configuration
        const AppConfig = {
            firebase: {
                apiKey: "AIzaSyDA223bKA90MX_QpWuF1ARgWKldjXuiNo4",
                authDomain: "renthub-2030.firebaseapp.com",
                projectId: "renthub-2030",
                storageBucket: "renthub-2030.firebasestorage.app",
                messagingSenderId: "23301901800",
                appId: "1:23301901800:web:2679c834aac406c72d685d",
                measurementId: "G-XXXXXXXXXX"
            },
            security: {
                maxSearchLength: 100,
                maxLocationLength: 50,
                minPrice: 0,
                maxPrice: 10000,
                rateLimit: {
                    requests: 10,
                    timeWindow: 60000
                }
            },
            features: {
                darkMode: true,
                offlineSupport: true,
                instantSearch: false,
                geolocation: false
            }
        };

        // Security Utilities
        const SecurityUtils = Object.freeze({
            sanitizeText(text, maxLength = 100) {
                if (!text || typeof text !== 'string') return '';
                
                // Remove dangerous characters but keep basic formatting
                let sanitized = String(text)
                    .replace(/[<>]/g, '') // Remove < and >
                    .replace(/javascript:/gi, '') // Remove javascript:
                    .replace(/on\w+=/gi, '') // Remove event handlers
                    .trim();
                
                // Limit length
                if (maxLength && sanitized.length > maxLength) {
                    sanitized = sanitized.substring(0, maxLength) + '...';
                }
                
                return sanitized;
            },

            sanitizeHTML(html) {
                if (!html) return '';
                
                const temp = document.createElement('div');
                temp.textContent = String(html);
                return temp.innerHTML;
            },

            validateURL(url) {
                if (!url || typeof url !== 'string') return false;
                
                try {
                    const urlObj = new URL(url);
                    const allowedProtocols = ['https:', 'http:', 'data:'];
                    const allowedHosts = [
                        'unsplash.com',
                        'firebasestorage.googleapis.com',
                        'cloudinary.com',
                        'localhost'
                    ];
                    
                    return allowedProtocols.includes(urlObj.protocol) && 
                           (allowedHosts.some(host => urlObj.hostname.includes(host)) || 
                            urlObj.protocol === 'data:');
                } catch {
                    return false;
                }
            },

            sanitizeURL(url, fallback = 'https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80') {
                return this.validateURL(url) ? url : fallback;
            },

            validateNumber(num, min = 0, max = 10000) {
                if (num === '' || num === null || num === undefined) return null;
                
                const parsed = parseFloat(num);
                if (isNaN(parsed)) return null;
                
                return Math.max(min, Math.min(max, parsed));
            },

            rateLimiter: {
                requests: new Map(),
                
                isAllowed(key, maxRequests = 10, timeWindow = 60000) {
                    const now = Date.now();
                    
                    if (!this.requests.has(key)) {
                        this.requests.set(key, []);
                    }
                    
                    const timestamps = this.requests.get(key);
                    const validTimestamps = timestamps.filter(time => now - time < timeWindow);
                    
                    if (validTimestamps.length >= maxRequests) {
                        return false;
                    }
                    
                    validTimestamps.push(now);
                    this.requests.set(key, validTimestamps);
                    return true;
                }
            }
        });

        // Application State
        const AppState = {
            user: null,
            listings: [],
            isLoading: false,
            error: null,
            
            setUser(user) {
                this.user = user;
                this.emit('userChanged', user);
            },
            
            setListings(listings) {
                this.listings = listings;
                this.emit('listingsChanged', listings);
            },
            
            setLoading(loading) {
                this.isLoading = loading;
                this.emit('loadingChanged', loading);
            },
            
            setError(error) {
                this.error = error;
                this.emit('errorChanged', error);
            },
            
            listeners: {},
            
            on(event, callback) {
                if (!this.listeners[event]) {
                    this.listeners[event] = [];
                }
                this.listeners[event].push(callback);
            },
            
            emit(event, data) {
                if (this.listeners[event]) {
                    this.listeners[event].forEach(callback => callback(data));
                }
            }
        };

        // Initialize Firebase
        class FirebaseService {
            constructor() {
                this.app = null;
                this.auth = null;
                this.db = null;
                this.storage = null;
                this.initialized = false;
            }

            async initialize() {
                try {
                    this.app = firebase.initializeApp(AppConfig.firebase);
                    this.auth = firebase.auth();
                    this.db = firebase.firestore();
                    this.storage = firebase.storage();
                    this.initialized = true;
                    
                    console.log('Firebase inicializado correctamente');
                    return true;
                } catch (error) {
                    console.error('Error inicializando Firebase:', error);
                    return false;
                }
            }

            async getFeaturedListings(limit = 6) {
                if (!this.initialized || !this.db) {
                    throw new Error('Firebase no inicializado');
                }

                try {
                    const listingsRef = this.db.collection('listings');
                    const snapshot = await listingsRef
                        .where('status', '==', 'active')
                        .where('featured', '==', true)
                        .orderBy('createdAt', 'desc')
                        .limit(limit)
                        .get();

                    const listings = [];
                    snapshot.forEach(doc => {
                        listings.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });

                    return listings;
                } catch (error) {
                    console.error('Error obteniendo listings:', error);
                    throw error;
                }
            }

            async searchListings(filters) {
                if (!this.initialized || !this.db) {
                    throw new Error('Firebase no inicializado');
                }

                try {
                    let query = this.db.collection('listings');
                    
                    // Apply filters
                    if (filters.category) {
                        query = query.where('category', '==', filters.category);
                    }
                    
                    if (filters.maxPrice) {
                        query = query.where('price', '<=', filters.maxPrice);
                    }
                    
                    if (filters.location) {
                        query = query.where('location', '==', filters.location);
                    }
                    
                    query = query.where('status', '==', 'active');
                    const snapshot = await query.limit(50).get();
                    
                    const listings = [];
                    snapshot.forEach(doc => {
                        listings.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    return listings;
                } catch (error) {
                    console.error('Error buscando listings:', error);
                    throw error;
                }
            }
        }

        // UI Components
        class UIComponents {
            static createAuthButtons(user) {
                const container = document.getElementById('authButtons');
                if (!container) return;
                
                container.innerHTML = '';
                
                if (user) {
                    // User is logged in
                    const userMenu = document.createElement('div');
                    userMenu.className = 'user-menu';
                    userMenu.innerHTML = `
                        <a href="dashboard.html" class="btn btn-outline" aria-label="Ir a mi panel">
                            <i class="fas fa-user-circle" aria-hidden="true"></i>
                            <span>Mi Panel</span>
                        </a>
                        <button class="btn btn-primary logout-btn" aria-label="Cerrar sesión">
                            <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                            <span>Cerrar Sesión</span>
                        </button>
                    `;
                    
                    userMenu.querySelector('.logout-btn').addEventListener('click', () => {
                        firebase.auth().signOut()
                            .then(() => window.location.reload())
                            .catch(error => {
                                console.error('Error cerrando sesión:', error);
                                this.showError('Error al cerrar sesión');
                            });
                    });
                    
                    container.appendChild(userMenu);
                } else {
                    // User is not logged in
                    const authButtons = document.createElement('div');
                    authButtons.className = 'guest-buttons';
                    authButtons.innerHTML = `
                        <a href="auth.html?mode=login" class="btn btn-outline" aria-label="Iniciar sesión">
                            <i class="fas fa-sign-in-alt" aria-hidden="true"></i>
                            <span>Iniciar Sesión</span>
                        </a>
                        <a href="auth.html?mode=register" class="btn btn-primary" aria-label="Registrarse">
                            <i class="fas fa-user-plus" aria-hidden="true"></i>
                            <span>Registrarse</span>
                        </a>
                    `;
                    
                    container.appendChild(authButtons);
                }
            }

            static createListingCard(listing) {
                const card = document.createElement('article');
                card.className = 'listing-card';
                card.setAttribute('role', 'article');
                card.setAttribute('aria-labelledby', `listing-title-${listing.id}`);
                
                const sanitizedTitle = SecurityUtils.sanitizeText(listing.title, 50);
                const sanitizedLocation = SecurityUtils.sanitizeText(listing.location, 30);
                const sanitizedCategory = SecurityUtils.sanitizeText(listing.category, 20);
                const imageUrl = SecurityUtils.sanitizeURL(listing.images?.[0]);
                const price = SecurityUtils.validateNumber(listing.price, 0, 10000) || 0;
                const priceType = SecurityUtils.sanitizeText(listing.priceType || 'día');
                
                card.innerHTML = `
                    <div class="listing-image-container">
                        <img 
                            src="${imageUrl}" 
                            alt="${sanitizedTitle}" 
                            class="listing-image"
                            loading="lazy"
                            decoding="async"
                            width="300"
                            height="200"
                        >
                        <div class="listing-badge">
                            <span class="badge-text">Destacado</span>
                        </div>
                        <div class="listing-price">
                            <span class="price-amount">${price}€</span>
                            <span class="price-period">/${priceType}</span>
                        </div>
                    </div>
                    <div class="listing-content">
                        <h3 id="listing-title-${listing.id}" class="listing-title">
                            ${sanitizedTitle}
                        </h3>
                        <div class="listing-meta">
                            <span class="meta-item" aria-label="Ubicación">
                                <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
                                ${sanitizedLocation}
                            </span>
                            <span class="meta-item" aria-label="Categoría">
                                <i class="fas fa-tag" aria-hidden="true"></i>
                                ${sanitizedCategory}
                            </span>
                        </div>
                        <div class="listing-actions">
                            <button 
                                class="btn btn-primary view-btn"
                                aria-label="Ver detalles de ${sanitizedTitle}"
                                data-listing-id="${listing.id}"
                            >
                                <span>Ver Detalles</span>
                                <i class="fas fa-arrow-right" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                // Add click event
                card.querySelector('.view-btn').addEventListener('click', (e) => {
                    e.preventDefault();
                    const listingId = e.currentTarget.getAttribute('data-listing-id');
                    if (listingId) {
                        window.location.href = `listing-detail.html?id=${encodeURIComponent(listingId)}`;
                    }
                });
                
                // Make entire card clickable on mobile
                if (window.innerWidth < 768) {
                    card.addEventListener('click', (e) => {
                        if (!e.target.closest('.view-btn')) {
                            window.location.href = `listing-detail.html?id=${encodeURIComponent(listing.id)}`;
                        }
                    });
                    card.style.cursor = 'pointer';
                }
                
                return card;
            }

            static showError(message) {
                // Create error toast
                const toast = document.createElement('div');
                toast.className = 'error-toast';
                toast.setAttribute('role', 'alert');
                toast.innerHTML = `
                    <i class="fas fa-exclamation-circle" aria-hidden="true"></i>
                    <span>${SecurityUtils.sanitizeText(message)}</span>
                    <button class="toast-close" aria-label="Cerrar mensaje">
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                `;
                
                document.body.appendChild(toast);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    toast.remove();
                }, 5000);
                
                // Close button
                toast.querySelector('.toast-close').addEventListener('click', () => {
                    toast.remove();
                });
            }

            static showLoading() {
                const listingsGrid = document.getElementById('featuredListings');
                if (listingsGrid) {
                    listingsGrid.innerHTML = `
                        <div class="loading-state" role="status" aria-label="Cargando productos">
                            <div class="spinner" aria-hidden="true"></div>
                            <p>Cargando productos destacados...</p>
                        </div>
                    `;
                }
            }

            static hideLoading() {
                const loadingState = document.querySelector('.loading-state');
                if (loadingState) {
                    loadingState.remove();
                }
            }
        }

        // Main Application
        class RentHubApp {
            constructor() {
                this.firebaseService = new FirebaseService();
                this.initialize();
            }

            async initialize() {
                try {
                    // Set current year in footer
                    document.getElementById('current-year').textContent = new Date().getFullYear();
                    
                    // Initialize Firebase
                    const firebaseInitialized = await this.firebaseService.initialize();
                    
                    if (!firebaseInitialized) {
                        throw new Error('No se pudo inicializar Firebase');
                    }
                    
                    // Set up auth state listener
                    firebase.auth().onAuthStateChanged((user) => {
                        AppState.setUser(user);
                        UIComponents.createAuthButtons(user);
                    });
                    
                    // Load featured listings
                    await this.loadFeaturedListings();
                    
                    // Set up event listeners
                    this.setupEventListeners();
                    
                    // Initialize mobile menu
                    this.initMobileMenu();
                    
                    // Handle scroll effects
                    this.handleScroll();
                    
                    console.log('RentHub App inicializado correctamente');
                } catch (error) {
                    console.error('Error inicializando la aplicación:', error);
                    UIComponents.showError('Error al cargar la aplicación');
                }
            }

            async loadFeaturedListings() {
                try {
                    UIComponents.showLoading();
                    
                    if (!SecurityUtils.rateLimiter.isAllowed('loadListings', 5, 10000)) {
                        throw new Error('Demasiadas solicitudes. Intenta más tarde.');
                    }
                    
                    const listings = await this.firebaseService.getFeaturedListings(6);
                    AppState.setListings(listings);
                    
                    this.renderListings(listings);
                } catch (error) {
                    console.error('Error cargando listings:', error);
                    
                    // Show sample listings as fallback
                    this.showSampleListings();
                    
                    if (error.message !== 'Demasiadas solicitudes. Intenta más tarde.') {
                        UIComponents.showError('Error al cargar productos. Mostrando ejemplos.');
                    }
                } finally {
                    UIComponents.hideLoading();
                }
            }

            renderListings(listings) {
                const listingsGrid = document.getElementById('featuredListings');
                if (!listingsGrid) return;
                
                if (!listings || listings.length === 0) {
                    this.showSampleListings();
                    return;
                }
                
                listingsGrid.innerHTML = '';
                
                listings.forEach(listing => {
                    const card = UIComponents.createListingCard(listing);
                    listingsGrid.appendChild(card);
                });
            }

            showSampleListings() {
                const sampleListings = [
                    {
                        id: '1',
                        title: 'Taladro Percutor Profesional',
                        description: 'Taladro de alta potencia para trabajos profesionales',
                        location: 'Madrid',
                        price: 15,
                        priceType: 'día',
                        category: 'Herramientas',
                        images: ['https://images.unsplash.com/photo-1581094794329-c8112a89af12?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80']
                    },
                    {
                        id: '2',
                        title: 'Cámara DSLR Canon EOS',
                        description: 'Cámara profesional con lente 24-70mm',
                        location: 'Barcelona',
                        price: 40,
                        priceType: 'día',
                        category: 'Electrónica',
                        images: ['https://images.unsplash.com/photo-1516035069371-29a1b244cc32?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80']
                    },
                    {
                        id: '3',
                        title: 'Bicicleta de Montaña',
                        description: 'Bicicleta de montaña de 21 velocidades',
                        location: 'Valencia',
                        price: 12,
                        priceType: 'día',
                        category: 'Deportes',
                        images: ['https://images.unsplash.com/photo-1532298229144-0ec0c57515c7?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80']
                    }
                ];
                
                this.renderListings(sampleListings);
            }

            setupEventListeners() {
                // Search form submission
                const searchForm = document.querySelector('.search-form');
                if (searchForm) {
                    searchForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handleSearch();
                    });
                }
                
                // Search input keypress
                const searchInput = document.getElementById('search-input');
                if (searchInput) {
                    searchInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.handleSearch();
                        }
                    });
                }
                
                // Price input validation
                const priceInput = document.getElementById('max-price-input');
                if (priceInput) {
                    priceInput.addEventListener('input', (e) => {
                        const value = parseFloat(e.target.value);
                        if (value < 0) e.target.value = 0;
                        if (value > 10000) e.target.value = 10000;
                    });
                }
                
                // Listen to state changes
                AppState.on('userChanged', (user) => {
                    console.log('Usuario cambiado:', user?.email);
                });
                
                AppState.on('errorChanged', (error) => {
                    if (error) {
                        UIComponents.showError(error.message);
                    }
                });
            }

            initMobileMenu() {
                const menuToggle = document.querySelector('.mobile-menu-toggle');
                const mainMenu = document.getElementById('main-menu');
                
                if (!menuToggle || !mainMenu) return;
                
                menuToggle.addEventListener('click', () => {
                    const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
                    menuToggle.setAttribute('aria-expanded', !isExpanded);
                    mainMenu.classList.toggle('show');
                    
                    // Update icon
                    const icon = menuToggle.querySelector('i');
                    if (icon) {
                        icon.className = isExpanded ? 'fas fa-bars' : 'fas fa-times';
                    }
                });
                
                // Close menu when clicking outside
                document.addEventListener('click', (e) => {
                    if (!mainMenu.contains(e.target) && !menuToggle.contains(e.target)) {
                        menuToggle.setAttribute('aria-expanded', 'false');
                        mainMenu.classList.remove('show');
                        menuToggle.querySelector('i').className = 'fas fa-bars';
                    }
                });
                
                // Close menu on escape key
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        menuToggle.setAttribute('aria-expanded', 'false');
                        mainMenu.classList.remove('show');
                        menuToggle.querySelector('i').className = 'fas fa-bars';
                    }
                });
            }

            handleScroll() {
                const header = document.querySelector('.main-header');
                
                window.addEventListener('scroll', () => {
                    if (window.scrollY > 50) {
                        header.classList.add('scrolled');
                    } else {
                        header.classList.remove('scrolled');
                    }
                });
            }

            handleSearch() {
                const searchInput = document.getElementById('search-input');
                const locationInput = document.getElementById('location-input');
                const categorySelect = document.getElementById('category-select');
                const durationSelect = document.getElementById('duration-select');
                const maxPriceInput = document.getElementById('max-price-input');
                
                // Validate and sanitize inputs
                const query = SecurityUtils.sanitizeText(searchInput?.value, 100);
                const location = SecurityUtils.sanitizeText(locationInput?.value, 50);
                const category = SecurityUtils.sanitizeText(categorySelect?.value);
                const duration = SecurityUtils.sanitizeText(durationSelect?.value);
                const maxPrice = SecurityUtils.validateNumber(maxPriceInput?.value, 0, 10000);
                
                // Build query parameters
                const params = new URLSearchParams();
                
                if (query) params.append('q', query);
                if (location) params.append('location', location);
                if (category) params.append('category', category);
                if (duration) params.append('duration', duration);
                if (maxPrice !== null) params.append('maxPrice', maxPrice);
                
                // Navigate to search results
                const queryString = params.toString();
                window.location.href = `listings.html${queryString ? '?' + queryString : ''}`;
            }
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Check for WebP support
            const supportsWebP = () => {
                const canvas = document.createElement('canvas');
                canvas.width = canvas.height = 1;
                return canvas.toDataURL ? canvas.toDataURL('image/webp').indexOf('image/webp') === 5 : false;
            };
            
            if (!supportsWebP()) {
                document.documentElement.classList.add('no-webp');
            }
            
            // Initialize application
            window.rentHubApp = new RentHubApp();
            
            // Set up global error handling
            window.addEventListener('error', (event) => {
                console.error('Error no manejado:', event.error);
                UIComponents.showError('Ocurrió un error inesperado');
            });
            
            window.addEventListener('unhandledrejection', (event) => {
                console.error('Promise rechazada no manejada:', event.reason);
                UIComponents.showError('Ocurrió un error inesperado');
            });
        });

        // Global functions (for backward compatibility)
        window.searchListings = function() {
            if (window.rentHubApp) {
                window.rentHubApp.handleSearch();
            }
        };
    </script>

    <!-- Non-critical CSS -->
    <style>
        /* Container */
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Navigation */
        .navbar {
            padding: 1rem 0;
        }
        
        .nav-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: var(--primary-700);
            font-weight: 700;
            font-size: 1.5rem;
        }
        
        .logo i {
            font-size: 1.8rem;
        }
        
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--gray-700);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
            border-radius: var(--radius-sm);
            transition: background-color var(--transition-fast);
        }
        
        .mobile-menu-toggle:hover,
        .mobile-menu-toggle:focus {
            background-color: var(--gray-100);
            outline: 2px solid var(--primary-500);
        }
        
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        .nav-links {
            display: flex;
            gap: 1.5rem;
            list-style: none;
        }
        
        .nav-link {
            text-decoration: none;
            color: var(--gray-700);
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
            position: relative;
        }
        
        .nav-link:hover,
        .nav-link:focus {
            color: var(--primary-600);
            background-color: var(--primary-50);
            outline: none;
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background-color: var(--primary-500);
            transition: width var(--transition-fast);
        }
        
        .nav-link:hover::after,
        .nav-link:focus::after {
            width: 80%;
        }
        
        .nav-buttons {
            display: flex;
            gap: 1rem;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all var(--transition-base);
            font-size: 1rem;
            min-height: 44px;
            min-width: 44px;
        }
        
        .btn:focus {
            outline: 3px solid var(--primary-300);
            outline-offset: 2px;
        }
        
        .btn-outline {
            background-color: transparent;
            border-color: var(--primary-500);
            color: var(--primary-500);
        }
        
        .btn-outline:hover,
        .btn-outline:focus {
            background-color: var(--primary-500);
            color: white;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-700));
            color: white;
            border: none;
        }
        
        .btn-primary:hover,
        .btn-primary:focus {
            background: linear-gradient(135deg, var(--primary-600), var(--primary-800));
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, rgba(94, 53, 177, 0.9), rgba(106, 90, 205, 0.9)), 
                        url('https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            padding: 150px 0 100px;
            position: relative;
            overflow: hidden;
        }
        
        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        .hero-title {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            line-height: 1.2;
            animation: fadeInDown 1s ease;
        }
        
        .hero-description {
            font-size: 1.25rem;
            opacity: 0.9;
            margin-bottom: 3rem;
            animation: fadeInUp 1s ease 0.3s both;
        }
        
        /* Search Form */
        .search-form {
            animation: fadeInUp 1s ease 0.6s both;
        }
        
        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            backdrop-filter: blur(10px);
        }
        
        .search-field {
            position: relative;
        }
        
        .search-input,
        .search-select {
            width: 100%;
            padding: 1rem 1.5rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            transition: all var(--transition-fast);
            background-color: white;
            color: var(--gray-900);
        }
        
        .search-input:focus,
        .search-select:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(94, 53, 177, 0.2);
        }
        
        .search-button {
            grid-column: 1 / -1;
            justify-content: center;
            font-size: 1.1rem;
            padding: 1.25rem;
            margin-top: 0.5rem;
        }
        
        /* Categories Section */
        .categories {
            padding: 5rem 0;
            background-color: var(--gray-50);
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 1rem;
        }
        
        .section-subtitle {
            font-size: 1.125rem;
            color: var(--gray-600);
            max-width: 600px;
            margin: 0 auto;
        }
        
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }
        
        .category-card {
            display: block;
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            text-decoration: none;
            color: inherit;
            transition: all var(--transition-base);
            box-shadow: var(--shadow-md);
            position: relative;
        }
        
        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-500), var(--secondary-500));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform var(--transition-base);
        }
        
        .category-card:hover::before {
            transform: scaleX(1);
        }
        
        .category-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }
        
        .category-card:focus {
            outline: 3px solid var(--primary-300);
            outline-offset: 4px;
        }
        
        .category-icon {
            padding: 3rem;
            text-align: center;
            background: linear-gradient(135deg, var(--primary-500), var(--secondary-500));
            color: white;
            font-size: 3rem;
        }
        
        .category-content {
            padding: 2rem;
        }
        
        .category-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--gray-900);
        }
        
        .category-description {
            color: var(--gray-600);
            line-height: 1.6;
        }
        
        /* Featured Listings */
        .featured-listings {
            padding: 5rem 0;
        }
        
        .listings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
        }
        
        .listing-card {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-base);
            border: 1px solid var(--gray-200);
        }
        
        .listing-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }
        
        .listing-image-container {
            position: relative;
            height: 200px;
            overflow: hidden;
        }
        
        .listing-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-base);
        }
        
        .listing-card:hover .listing-image {
            transform: scale(1.05);
        }
        
        .listing-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background-color: var(--accent-500);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .listing-price {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.95);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            font-weight: 700;
            color: var(--primary-700);
            backdrop-filter: blur(4px);
        }
        
        .price-amount {
            font-size: 1.25rem;
        }
        
        .price-period {
            font-size: 0.875rem;
            opacity: 0.8;
        }
        
        .listing-content {
            padding: 1.5rem;
        }
        
        .listing-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--gray-900);
            line-height: 1.4;
        }
        
        .listing-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--gray-600);
            font-size: 0.875rem;
        }
        
        .meta-item i {
            color: var(--primary-500);
        }
        
        .listing-actions {
            display: flex;
            justify-content: flex-end;
        }
        
        /* How It Works */
        .how-it-works {
            padding: 5rem 0;
            background-color: var(--gray-50);
        }
        
        .steps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 3rem;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .step {
            text-align: center;
            padding: 2rem;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            transition: all var(--transition-base);
        }
        
        .step:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .step-number {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-500), var(--secondary-500));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0 auto 1.5rem;
        }
        
        .step-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--gray-900);
        }
        
        .step-description {
            color: var(--gray-600);
            line-height: 1.6;
        }
        
        /* Footer */
        .main-footer {
            background-color: var(--gray-900);
            color: white;
            padding: 4rem 0 2rem;
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            margin-bottom: 3rem;
        }
        
        .footer-section {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .footer-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: white;
            margin-bottom: 0.5rem;
        }
        
        .footer-description {
            color: var(--gray-300);
            line-height: 1.6;
        }
        
        .footer-links {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .footer-link {
            color: var(--gray-300);
            text-decoration: none;
            transition: color var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .footer-link:hover,
        .footer-link:focus {
            color: white;
            outline: none;
        }
        
        .footer-address {
            font-style: normal;
        }
        
        .footer-bottom {
            padding-top: 2rem;
            border-top: 1px solid var(--gray-800);
            text-align: center;
        }
        
        .copyright {
            color: var(--gray-400);
        }
        
        /* Loading States */
        .skeleton-listing {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }
        
        .skeleton-image {
            height: 200px;
            background: linear-gradient(90deg, var(--gray-100) 25%, var(--gray-200) 50%, var(--gray-100) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        .skeleton-content {
            padding: 1.5rem;
        }
        
        .skeleton-title {
            height: 24px;
            width: 70%;
            background: linear-gradient(90deg, var(--gray-100) 25%, var(--gray-200) 50%, var(--gray-100) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius-sm);
            margin-bottom: 1rem;
        }
        
        .skeleton-text {
            height: 16px;
            width: 90%;
            background: linear-gradient(90deg, var(--gray-100) 25%, var(--gray-200) 50%, var(--gray-100) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius-sm);
        }
        
        .loading-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 3rem;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--gray-200);
            border-top-color: var(--primary-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        /* Error Toast */
        .error-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--error-500);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 9999;
            animation: slideInRight 0.3s ease;
            max-width: 400px;
        }
        
        .toast-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 4px;
            border-radius: var(--radius-sm);
            transition: background-color var(--transition-fast);
        }
        
        .toast-close:hover,
        .toast-close:focus {
            background-color: rgba(255, 255, 255, 0.2);
            outline: none;
        }
        
        /* User Menu */
        .user-menu,
        .guest-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .hero-description {
                font-size: 1.125rem;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
            
            .nav-menu {
                position: fixed;
                top: 70px;
                left: 0;
                right: 0;
                background: white;
                flex-direction: column;
                padding: 2rem;
                box-shadow: var(--shadow-lg);
                transform: translateY(-100%);
                opacity: 0;
                visibility: hidden;
                transition: all var(--transition-base);
                z-index: 999;
            }
            
            .nav-menu.show {
                transform: translateY(0);
                opacity: 1;
                visibility: visible;
            }
            
            .nav-links {
                flex-direction: column;
                width: 100%;
                gap: 0;
            }
            
            .nav-link {
                padding: 1rem;
                border-radius: var(--radius-sm);
                width: 100%;
            }
            
            .nav-buttons {
                flex-direction: column;
                width: 100%;
            }
            
            .search-grid {
                grid-template-columns: 1fr;
            }
            
            .categories-grid,
            .listings-grid {
                grid-template-columns: 1fr;
            }
            
            .steps-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .footer-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
        }
        
        @media (max-width: 480px) {
            .hero-title {
                font-size: 2rem;
            }
            
            .hero {
                padding: 120px 0 80px;
            }
            
            .btn {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
            }
        }
        
        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            :root:not(.no-dark-mode) {
                --gray-50: #1a1a1a;
                --gray-100: #212121;
                --gray-200: #424242;
                --gray-300: #616161;
                --gray-400: #757575;
                --gray-500: #9e9e9e;
                --gray-600: #bdbdbd;
                --gray-700: #e0e0e0;
                --gray-800: #eeeeee;
                --gray-900: #f5f5f5;
            }
            
            :root:not(.no-dark-mode) body {
                background-color: #121212;
                color: var(--gray-800);
            }
            
            :root:not(.no-dark-mode) .main-header {
                background: rgba(18, 18, 18, 0.95);
            }
            
            :root:not(.no-dark-mode) .categories,
            :root:not(.no-dark-mode) .how-it-works {
                background-color: var(--gray-100);
            }
            
            :root:not(.no-dark-mode) .category-card,
            :root:not(.no-dark-mode) .step,
            :root:not(.no-dark-mode) .listing-card,
            :root:not(.no-dark-mode) .search-input,
            :root:not(.no-dark-mode) .search-select {
                background-color: var(--gray-50);
                border-color: var(--gray-200);
            }
        }
        
        /* Print Styles */
        @media print {
            .nav-buttons,
            .search-form,
            .footer-links,
            .mobile-menu-toggle {
                display: none !important;
            }
            
            .hero {
                background: none !important;
                color: black !important;
                padding: 2rem 0 !important;
            }
            
            .category-card,
            .listing-card,
            .step {
                break-inside: avoid;
                box-shadow: none !important;
                border: 1px solid #ddd !important;
            }
        }
    </style>
</body>
</html>

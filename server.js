// =======================================================
// server.js - Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: ØªØ£Ø³ÙŠØ³ Ø§Ù„Ø®Ø§Ø¯Ù… ÙˆÙ†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
// =======================================================

const express = require('express');
const mongoose = require('mongoose');
const bcrypt = require('bcrypt'); // Ù„ØªØ´ÙÙŠØ± ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±
const app = express();
const PORT = 3000; // Ø§Ù„Ù…Ù†ÙØ° Ø§Ù„Ø°ÙŠ Ø³ÙŠØ¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø®Ø§Ø¯Ù… Ù…Ø­Ù„ÙŠØ§Ù‹

// Middleware: ÙŠØ³Ù…Ø­ Ù„Ù„Ø®Ø§Ø¯Ù… Ø¨Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØµÙŠØºØ© JSON
app.use(express.json());

// ===================================
// Ø£. Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª MongoDB
// ===================================

// **Ù‡Ø§Ù…**: ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù„Ø¯ÙŠÙƒ Ø®Ø§Ø¯Ù… MongoDB ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø£Ùˆ Ø®Ø¯Ù…Ø© MongoDB Ø³Ø­Ø§Ø¨ÙŠØ© (Ù…Ø«Ù„ Atlas)
mongoose.connect('mongodb://localhost:27017/RentHubDB', {
  useNewUrlParser: true,      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø­ÙˆÙ„ URL Ø§Ù„Ø¬Ø¯ÙŠØ¯
  useUnifiedTopology: true    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø­Ø±Ùƒ Ø§Ù„Ø§ÙƒØªØ´Ø§Ù ÙˆØ§Ù„Ø¥Ø´Ø±Ø§Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯
  // (Ù…Ù„Ø§Ø­Ø¸Ø©: ÙÙŠ Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© Ù…Ù† MongooseØŒ Ù‚Ø¯ Ù„Ø§ ØªÙƒÙˆÙ† Ù‡Ø°Ù‡ Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø¶Ø±ÙˆØ±ÙŠØ©)
}).then(() => {
    console.log('âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª MongoDB.');
}).catch(err => {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', err);
});

// ===================================
// Ø¨. ØªØ¹Ø±ÙŠÙ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (User Schema)
// ===================================

const userSchema = new mongoose.Schema({
    // Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: Ù…Ø·Ù„ÙˆØ¨ ÙˆÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ±ÙŠØ¯Ø§Ù‹ (Ù„Ø§ ÙŠØªÙƒØ±Ø±)
    email: { 
        type: String, 
        required: true, 
        unique: true, 
        trim: true 
    },
    // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø­ÙØ¸Ù‡Ø§ Ù…Ø´ÙØ±Ø© (hashed)
    password: { 
        type: String, 
        required: true,
        minlength: 6 // Ø­Ø¯ Ø£Ø¯Ù†Ù‰ Ù„Ø·ÙˆÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    },
    // Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ÙƒÙ…Ø¤Ø¬Ø± Ø£Ùˆ Ù…Ø³ØªØ£Ø¬Ø±)
    role: {
        type: String,
        enum: ['renter', 'owner'], // Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§
        default: 'renter'
    },
    createdAt: { 
        type: Date, 
        default: Date.now // ØªØ§Ø±ÙŠØ® Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
    }
});

// Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙŠ Ø³Ù†Ø³ØªØ®Ø¯Ù…Ù‡ Ù„Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
const User = mongoose.model('User', userSchema);

// Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠ Ù…Ù„ÙØ§Øª Ø£Ø®Ø±Ù‰ (Ù…Ø«Ù„ Ù…Ø³Ø§Ø±Ø§Øª API)
module.exports = User;


// ===================================
// Ø¬. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… ÙˆØ§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø·Ù„Ø¨Ø§Øª
// ===================================

app.listen(PORT, () => {
    console.log(`ðŸš€ Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰: http://localhost:${PORT}`);
});
